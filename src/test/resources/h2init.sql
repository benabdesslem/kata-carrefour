-- 1. AUTHORITY table
CREATE TABLE AUTHORITY
(
    NAME VARCHAR(50) NOT NULL, -- Use VARCHAR for character varying length
    CONSTRAINT PK_AUTHORITY PRIMARY KEY (NAME)
);

-- 2. DELIVERY_METHOD table
CREATE TABLE DELIVERY_METHOD
(
    ID   BIGINT NOT NULL AUTO_INCREMENT,
    NAME CHARACTER VARYING(255),
    CONSTRAINT PK_DELIVERY_METHOD PRIMARY KEY (ID)
);

-- 3. DELIVERY_TIME_SLOT table
CREATE TABLE DELIVERY_TIME_SLOT
(
    ID                 BIGINT                   NOT NULL AUTO_INCREMENT,
    START_TIME         TIMESTAMP WITH TIME ZONE NOT NULL,
    END_TIME           TIMESTAMP WITH TIME ZONE NOT NULL,
    DELIVERY_METHOD_ID BIGINT                   NOT NULL,
    CONSTRAINT PK_DELIVERY_TIME_SLOT PRIMARY KEY (ID),
    CONSTRAINT FK_DELIVERY_METHOD_ID FOREIGN KEY (DELIVERY_METHOD_ID) REFERENCES DELIVERY_METHOD
);

-- 4. USERS table (consider adding a unique constraint on email)
CREATE TABLE USERS
(
    ID         BIGINT       NOT NULL AUTO_INCREMENT,
    LOGIN      VARCHAR(255) NOT NULL UNIQUE, -- Unique constraint on login
    PASSWORD   VARCHAR(255) NOT NULL,
    FIRST_NAME CHARACTER VARYING(255),
    LAST_NAME  CHARACTER VARYING(255),
    EMAIL      VARCHAR(255) NOT NULL,        -- Consider adding UNIQUE constraint
    ACTIVATED  BOOLEAN,
    ADDRESS    VARCHAR(255),
    CONSTRAINT PK_USERS PRIMARY KEY (ID)
);

-- 5. BOOKING table
CREATE TABLE BOOKING
(
    ID                    BIGINT                   NOT NULL AUTO_INCREMENT,
    BOOKING_TIME          TIMESTAMP WITH TIME ZONE NOT NULL,
    USER_ID               BIGINT                   NOT NULL,
    DELIVERY_TIME_SLOT_ID BIGINT                   NOT NULL,
    CONSTRAINT PK_BOOKING PRIMARY KEY (ID),
    CONSTRAINT UNIQUE_BOOKING UNIQUE (USER_ID, DELIVERY_TIME_SLOT_ID), -- Use UNIQUE instead of separate constraint
    CONSTRAINT FK_BOOKING_DELIVERY_TIME_SLOT_ID FOREIGN KEY (DELIVERY_TIME_SLOT_ID) REFERENCES DELIVERY_TIME_SLOT,
    CONSTRAINT FK_BOOKING_USER_ID FOREIGN KEY (USER_ID) REFERENCES USERS
);

-- 8. USER_AUTHORITY table
CREATE TABLE USER_AUTHORITY
(
    USER_ID        BIGINT                 NOT NULL,
    AUTHORITY_NAME CHARACTER VARYING(255) NOT NULL,
    CONSTRAINT UNIQUE_USER_AUTHORITY PRIMARY KEY (USER_ID, AUTHORITY_NAME),
    CONSTRAINT FK_USER_AUTHORITY_AUTHORITY FOREIGN KEY (AUTHORITY_NAME) REFERENCES AUTHORITY,
    CONSTRAINT FK_USER_AUTHORITY_USERS FOREIGN KEY (USER_ID) REFERENCES USERS
);


INSERT INTO DELIVERY_METHOD (NAME)
VALUES ('DRIVE'),
       ('DELIVERY'),
       ('DELIVERY_TODAY'),
       ('DELIVERY_ASAP');

INSERT INTO USERS (LOGIN, PASSWORD, FIRST_NAME, LAST_NAME, EMAIL, ACTIVATED, ADDRESS)
VALUES ('user1', '$2a$10$nVokPe3YvViZmLYLy3FSteWYQKwU.EuGb5kkT8bArHAFjF2qNQztm', 'user1', 'user', 'user1@kata', true,
        '47 W 13th St');

INSERT INTO AUTHORITY (NAME)
VALUES ('ROLE_USER'),
       ('ROLE_ADMIN');

INSERT INTO USER_AUTHORITY (USER_ID, AUTHORITY_NAME)
VALUES (1, 'ROLE_USER');

INSERT INTO DELIVERY_TIME_SLOT (START_TIME, END_TIME, DELIVERY_METHOD_ID)
VALUES ('2024-05-26 08:00:00', '2024-05-26 10:00:00', 1),
       ('2024-05-26 10:00:00', '2024-05-26 12:00:00', 1),
       ('2024-05-26 13:00:00', '2024-05-26 15:00:00', 1),
       ('2024-05-26 15:00:00', '2024-05-26 17:00:00', 1),
       ('2024-05-26 17:00:00', '2024-05-26 19:00:00', 1),
       ('2024-05-26 09:00:00', '2024-05-26 11:00:00', 2),
       ('2024-05-26 11:00:00', '2024-05-26 13:00:00', 2),
       ('2024-05-26 14:00:00', '2024-05-26 16:00:00', 2),
       ('2024-05-26 08:30:00', '2024-05-26 10:30:00', 3),
       ('2024-05-26 10:30:00', '2024-05-26 12:30:00', 3),
       ('2024-05-26 13:30:00', '2024-05-26 15:30:00', 3),
       ('2024-05-26 15:30:00', '2024-05-26 17:30:00', 3),
       ('2024-05-26 08:00:00', '2024-05-26 10:00:00', 4),
       ('2024-05-26 10:00:00', '2024-05-26 12:00:00', 4);
